# ============================================
# Quality of Life Improvements
# ============================================

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase history limit
set -g history-limit 50000

# Enable focus events for better vim integration
set -g focus-events on

# Enable aggressive resize for better multi-client support
setw -g aggressive-resize on

# ============================================
# Key Bindings
# ============================================

unbind %
bind | split-window -h -c "#{pane_current_path}"

unbind '"'
bind - split-window -v -c "#{pane_current_path}"

bind c new-window -c "#{pane_current_path}"

unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

bind -r m resize-pane -Z

# Move panes around (swap positions)
bind -r H swap-pane -U   # Move pane up/left
bind -r L swap-pane -D   # Move pane down/right

# Pane borders - enhanced with Catppuccin colors
# Show pane numbers/titles at the top
set -g pane-border-status top
set -g pane-border-format " #P: #{pane_current_command} "

# Use rounded/heavy borders for better visual separation
set -g pane-border-lines heavy

# Pane border colors will be set by Catppuccin plugin
# Keeping manual fallbacks commented for reference:
# set -g pane-border-style "fg=#737994,bg=default"
# set -g pane-active-border-style "fg=#8caaee,bg=default,bold"

# Bell monitoring - alerts when Claude needs input
set -g visual-bell off  # Turn off flashing (annoying with errors)
set -g monitor-bell on   # Still monitor for bells
set -g bell-action any   # Monitor bells from any window
set -g window-status-bell-style 'fg=#f38ba8,bold,reverse'  # Visual indicator without blink

# ============================================
# Display Settings
# ============================================

set -g mouse on
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# ============================================
# Copy Mode Settings (Vi-style)
# ============================================

setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================
# Plugin Manager (TPM)
# ============================================

set -g @plugin 'tmux-plugins/tpm'

# Catppuccin theme plugin
set -g @plugin 'catppuccin/tmux'

# Other useful plugins
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-yank'

# Catppuccin configuration
set -g @catppuccin_flavor 'frappe' # or mocha, macchiato, latte
set -g @catppuccin_window_status_style "slanted"

# Make active window more visible
set -g @catppuccin_window_current_number_color "#{@thm_peach}"
set -g @catppuccin_window_current_text_color "#{@thm_crust}"
set -g @catppuccin_window_current_background_color "#{@thm_peach}"

# Window status icons (requires Nerd Font)
set -g @catppuccin_window_default_text "#W"  # Default window name
set -g @catppuccin_window_current_text "#W" # Current window name

# Custom window formatting with status icons
set -g @catppuccin_window_status_icon_enable "yes"
set -g @catppuccin_icon_window_last "󰖰 "
set -g @catppuccin_icon_window_current "󰖯 "
set -g @catppuccin_icon_window_zoom "󰁌 "
set -g @catppuccin_icon_window_mark "󰃀 "
set -g @catppuccin_icon_window_silent "󰂛 "
set -g @catppuccin_icon_window_activity "󱅫 "
set -g @catppuccin_icon_window_bell "󰂞 "

# Show window flags with custom colors
set -g @catppuccin_window_current_text "#[fg=#{@thm_peach},bold]󰣐 #W#{?window_zoomed_flag,  ,}"
set -g @catppuccin_window_default_text "#[fg=#{@thm_overlay1}] #W"

# Catppuccin status modules (v2.x syntax)
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_right_separator "█"
set -g @catppuccin_status_connect_separator "yes"

# Pane border colors (integrate with Catppuccin)
set -g @catppuccin_pane_border_style "fg=#{@thm_surface_0}"
set -g @catppuccin_pane_active_border_style "fg=#{@thm_peach}"

# Make active pane REALLY stand out
set -g pane-active-border-style "fg=#{@thm_peach},bg=default,bold"

# Date format with better spacing
set -g @catppuccin_date_time_text "%H:%M %Y-%m-%d"

# ============================================
# Performance Settings
# ============================================

# speed up escape
set -sg escape-time 0

# ============================================
# Vim Integration
# ============================================

#set -g @plugin 'christoomey/vim-tmux-navigator'

#set -g @continuum-restore 'on'
#set -g @continuum-boot 'on'

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state=,tty=,comm= | grep -iqE '^[^TXZ ]+ +#{s|/dev/||:pane_tty}\s+(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
# bind-key -n C-\\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"
bind-key -T copy-mode-vi C-h select-pane -L
bind-key -T copy-mode-vi C-j select-pane -D
bind-key -T copy-mode-vi C-k select-pane -U
bind-key -T copy-mode-vi C-l select-pane -R
# bind-key -T copy-mode-vi C-\\ select-pane -l

# ============================================
# Pane & Window Navigation by Number
# ============================================

# Navigate to pane by number (prefix + number)
bind-key 0 select-pane -t 0
bind-key 1 select-pane -t 1
bind-key 2 select-pane -t 2
bind-key 3 select-pane -t 3
bind-key 4 select-pane -t 4
bind-key 5 select-pane -t 5
bind-key 6 select-pane -t 6
bind-key 7 select-pane -t 7
bind-key 8 select-pane -t 8
bind-key 9 select-pane -t 9

# Navigate to window by number (Alt + number, no prefix)
bind-key -n M-0 select-window -t 0
bind-key -n M-1 select-window -t 1
bind-key -n M-2 select-window -t 2
bind-key -n M-3 select-window -t 3
bind-key -n M-4 select-window -t 4
bind-key -n M-5 select-window -t 5
bind-key -n M-6 select-window -t 6
bind-key -n M-7 select-window -t 7
bind-key -n M-8 select-window -t 8
bind-key -n M-9 select-window -t 9

# ============================================
# Popup Windows
# ============================================

# Quick lazygit popup (prefix + g)
bind-key g display-popup -d '#{pane_current_path}' -E -w 90% -h 90% "lazygit"

# Quick scratch terminal (prefix + t)
bind-key t display-popup -d '#{pane_current_path}' -E -w 80% -h 80%

# Quick Claude Code session (prefix + C)
bind-key C display-popup -E -w 95% -h 95% "claude"

# Status bar configuration (now handled by Catppuccin plugin)
# These are commented out but kept for reference
# set -g status on
# set -g status-position bottom
# set -g status-style 'bg=#303446,fg=#c6d0f5'
# set -g status-left '#[fg=#89b4fa,bold] #S #[default]│ '
# set -g status-left-length 30
# set -g status-right '#[fg=#626880]%Y-%m-%d %H:%M'
# set -g window-status-format '#[fg=#626880] #I:#W #F'
# set -g window-status-current-format '#[fg=#89b4fa,bold] #I:#W #F'

# Status bar essentials
set -g status on
set -g status-position bottom
set -g status-left-length 100
set -g status-right-length 150

# Configure status bar with Catppuccin modules (v2.x syntax)
# Simplified: session | CPU | battery | time
set -g status-left ""
set -g status-right "#{E:@catppuccin_status_session}"
set -agF status-right "#{E:@catppuccin_status_cpu}"
set -agF status-right "#{E:@catppuccin_status_battery}"
set -ag status-right "#{E:@catppuccin_status_date_time}"

# keep this line at the very bottom of tmux.conf
run '~/.tmux/plugins/tpm/tpm'

